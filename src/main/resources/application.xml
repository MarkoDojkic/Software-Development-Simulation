<?xml version="1.0" encoding="utf-8" ?>
<beans:beans xmlns:int="http://www.springframework.org/schema/integration"
             xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xmlns:beans="http://www.springframework.org/schema/beans"
             xmlns:context="http://www.springframework.org/schema/context"
             xmlns:int-stream="http://www.springframework.org/schema/integration/stream"
             xsi:schemaLocation="http://www.springframework.org/schema/beans
		https://www.springframework.org/schema/beans/spring-beans.xsd
		http://www.springframework.org/schema/context
		http://www.springframework.org/schema/context/spring-context.xsd
		http://www.springframework.org/schema/integration
		https://www.springframework.org/schema/integration/spring-integration.xsd
		http://www.springframework.org/schema/integration/stream
		https://www.springframework.org/schema/integration/stream/spring-integration-stream.xsd">

        <int:annotation-config/>

        <context:component-scan base-package="dev.markodojkic.softwaredevelopmentsimulation"/>

        <beans:bean id="printerTransformer" class="dev.markodojkic.softwaredevelopmentsimulation.transformer.PrinterTransformer">
                <beans:property name="infoTextColorANSICode" value="68"/>
                <beans:property name="errorTextColorANSICode" value="196"/>
        </beans:bean>
        <beans:bean id="developer" class="dev.markodojkic.softwaredevelopmentsimulation.Developer">
                <beans:property name="trivialTaskTypicalResolutionTimeCoefficient" value="80"/>
                <beans:property name="normalTaskTypicalResolutionTimeCoefficient" value="71"/>
                <beans:property name="minorTaskTypicalResolutionTimeCoefficient" value="64"/>
                <beans:property name="majorTaskTypicalResolutionTimeCoefficient" value="43"/>
                <beans:property name="criticalTaskTypicalResolutionTimeCoefficient" value="27"/>
                <beans:property name="blockerTaskTypicalResolutionTimeCoefficient" value="11"/>
        </beans:bean>

        <int:gateway id="projectOwner" service-interface="dev.markodojkic.softwaredevelopmentsimulation.ProjectOwner"/>
        <int:gateway id="IPrinter" service-interface="dev.markodojkic.softwaredevelopmentsimulation.interfaces.IPrinter"/>

        <int:chain input-channel="infoChannel">
                <int:transformer ref="printerTransformer" method="infoOutput"/>
                <int-stream:stdout-channel-adapter id="console-output" append-newline="true"/>
        </int:chain>
        <int:chain input-channel="errorChannel">
                <int:transformer ref="printerTransformer" method="errorOutput"/>
                <int-stream:stderr-channel-adapter id="console-error" append-newline="true"/>
        </int:chain>

        <int:channel id="epics">
<!--                <int:queue capacity="1"/>-->
        </int:channel>
        <int:channel id="inProgressEpic"/>

<!--        <int:bridge input-channel="epics" output-channel="inProgressEpic">-->
<!--                <int:poller fixed-delay="3000" max-messages-per-poll="1" />-->
<!--        </int:bridge>-->

<!--        <int:resequencer input-channel="inProgressEpic" output-channel="doneEpics" release-strategy-expression=""/>-->

        <int:chain input-channel="doneTasks" output-channel="infoChannel">
                <int:splitter expression="payload.id"/>
        </int:chain>

        <int:channel id="doneEpics"/>
        <int:channel id="currentSprintUserStories"/>
        <int:channel id="doneSprintUserStories"/>
        <int:channel id="toDoTechnicalTasks"/>
        <int:channel id="doneTechnicalTask"/>



        <int:channel id="trivialTechnicalTask"/>
        <int:channel id="normalTechnicalTask"/>
        <int:channel id="minorTechnicalTask"/>
        <int:channel id="majorTechnicalTask"/>
        <int:channel id="criticalTechnicalTask"/>
        <int:channel id="blockerTechnicalTask"/>

        <int:channel id="trivialTechnicalTaskQueue"><int:queue capacity="8"/></int:channel>
        <int:channel id="normalTechnicalTaskQueue"><int:queue capacity="6"/></int:channel>
        <int:channel id="minorTechnicalTaskQueue"><int:queue capacity="4"/></int:channel>
        <int:channel id="majorTechnicalTaskQueue"><int:queue capacity="2"/></int:channel>
        <int:channel id="criticalTechnicalTaskQueue"><int:queue capacity="1"/></int:channel>
        <int:channel id="blockerTechnicalTaskQueue"><int:queue capacity="1"/></int:channel>

        <int:bridge input-channel="trivialTechnicalTaskQueue" output-channel="trivialTechnicalTask">
                <int:poller fixed-delay="1000"/>
        </int:bridge>

        <int:bridge input-channel="normalTechnicalTaskQueue" output-channel="normalTechnicalTask">
                <int:poller fixed-delay="1000"/>
        </int:bridge>

        <int:bridge input-channel="minorTechnicalTaskQueue" output-channel="minorTechnicalTask">
                <int:poller fixed-delay="1000"/>
        </int:bridge>

        <int:bridge input-channel="majorTechnicalTaskQueue" output-channel="majorTechnicalTask">
                <int:poller fixed-delay="1000"/>
        </int:bridge>

        <int:bridge input-channel="criticalTechnicalTaskQueue" output-channel="criticalTechnicalTask">
                <int:poller fixed-delay="1000"/>
        </int:bridge>

        <int:bridge input-channel="blockerTechnicalTaskQueue" output-channel="blockerTechnicalTask">
                <int:poller fixed-delay="1000"/>
        </int:bridge>
</beans:beans>
